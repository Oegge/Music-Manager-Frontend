<div class="heading-m">Upload Songs</div>
<input #fileInput type="file" (change)="onFilesSelected($event)" multiple/>
<div class="campaign-select">
    <div>Add to Campaigns</div>
    <mat-form-field>
        <mat-select
                [formControl]="selectedCampaignsControl"
                multiple
                placeholder="Select campaigns"
        >
            <mat-option *ngFor="let campaign of availableCampaigns" [value]="campaign">
                {{ campaign.name }}
            </mat-option>
        </mat-select>
    </mat-form-field>
</div>

<div *ngIf="songs?.length" class="rename-box">
    <div class="heading-s">Rename titles (Regex)</div>

    <div class="rename-row">
        <div class="input-group">
            <label>Pattern</label>
            <input
                    type="text"
                    [formControl]="renamePatternControl"
                    (input)="updateRenamePreview()"
                    placeholder="^CD\d+\s*-\s*"
            />
        </div>

        <div class="input-group">
            <label>Replace</label>
            <input
                    type="text"
                    [formControl]="renameReplaceControl"
                    (input)="updateRenamePreview()"
                    placeholder=""
            />
        </div>

        <button class="btn" type="button" (click)="applyRenameRegex()">
            Apply
        </button>
    </div>

    <div class="preview" *ngIf="previewOriginal">
        <div class="preview-title">Preview (first song)</div>

        <div *ngIf="previewError" class="error">
            {{ previewError }}
        </div>

        <div class="preview-row">
            <div class="preview-label">Original:</div>
            <div class="preview-value">{{ previewOriginal }}</div>
        </div>

        <div class="preview-row">
            <div class="preview-label">Result:</div>
            <div class="preview-value">{{ previewResult }}</div>
        </div>
    </div>
</div>

<div *ngFor="let song of songs; let i = index" class="song-entry">
    <div>
        <label for="title-{{ i }}">Title</label>
        <input
                id="title-{{ i }}"
                type="text"
                [(ngModel)]="song.title"
                placeholder="Enter title"
                required
        />
    </div>
    <div>
        <label for="tags-{{ i }}">Tags</label>
        <mat-form-field>
            <mat-select
                    [formControl]="song.selectedTagsControl"
                    multiple
                    placeholder="Select tags"
                    class="select"
            >
                <mat-option class="select2-results__option--selectable">
                    <ngx-mat-select-search
                            [formControl]="song.tagSearchControl"
                            placeholderLabel="Search tags"
                            noEntriesFoundLabel="No tags found"
                    ></ngx-mat-select-search>
                </mat-option>

                <mat-option *ngFor="let tag of filteredTags[i]" [value]="tag">
                    {{ tag.name }}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
</div>
<button class="btn" [ngClass]="{ disabled: !songs || songs.length === 0 }" (click)="submitSongs()">Submit</button>
